# **RAY DID protocol Specification**

Version 1.0.1

## About

The RAY (Blockchain Identifier Infrastructure) DID (hereinafter referred to as RAY) method specification conforms to the requirements specified in the DID specification currently published by the W3C Credentials Community Group. For more information about DIDs and DID method specifications, please see the [DID Primer](https://github.com/WebOfTrustInfo/rebooting-the-web-of-trust-fall2017/blob/master/topics-and-advance-readings/did-primer.md) and [DID Spec](https://w3c-ccg.github.io/did-spec/).

## Abstract

RAY provides distributed identifiers and blockchain-based digital identity services for people, enterprises, devices and digital objects. It aims to build a decentralized, data-secure, privacy-protected and flexible identifier system that addresses trusted connections among people, enterprises, devices and digital objects，enabling the vision of the Internet of Things and trust ingress with everything.

RAY is built on decentralized identification protocols and equipped with characters like decentralization, self-management, privacy protection, security and ease of use. Each RAY links to one RAY DID Description Object (DDO).

## <u>Blockchain-Based</u> Identifier (RAY)

### 1. Target System(s)

This DID method is applicable to the RAY network and has been used formally since the RAY released.

### 2. RAY identifiers definition

A RAY identifier is a simple text string consisting  of three parts:

- URL scheme identifier (did)

- Identifier for the DID method (ray)

- DID method-specific identifier

Example：did:ray:3acdafe161ef702033bdf895

### 3. RAY Name Space

- The name string that shall identify this DID method is: ray

- A RAY that generated by this method MUST begin with the following prefix: did:ray. Per the DID specification, this string MUST be in lowercase. The remaining part of the RAY, after the prefix, is generated with algorithm in section 4.

### 4. RAY Specific Identifier Generation

Two cryptographic algorithms are supported during RAY identifiers generation, i.e., elliptic curve cryptography and SM2.  RAY identifiers are randomly generated with either of the two cryptographic algorithms, outputting public key. Then we hash the public key and take the first 24 bits from the hash result.

The RAY identifier is defined by the following ABNF：

```
bif-did = "did:ray:" idstring *(":" subnamespace)
idstring = 24(char)
subnamespace = ALPHA *(ALPHA / DIGIT / "_" / "-")
```

The detailed RAY identifier generation procedure is indicated in following diagram.

###  5. RAY Identity Description Object

One DID description object (DDO) corresponds to one RAY registered on the RAY blockchain, which is open to the public to read. DDO document is uploaded by the DDO controller .

The DDO specification includes following parameters:

-   Name: a nickname is set to improve the availability of the ray identifier. It can take place of corresponding ray identifier on the client, which means users can exchange credits with nickname instead of the RAY address. Nickname is globally unique as RAY identifier.
-   publicKey: The public key is used for identity authentication. The public key parameters include public key id, the public key type, corresponding RAY identifier and authorization limits (if the value is 'all', the public key can perform all the defined operations on the ray document);
-   authentication: one list containing information of the users' authenticated identity attributes, e.g., education degree and passport. The list contains information for each authentication, including authentication type, the public key used for authentication,  and ID of the verifiable credential.
-   service: every service is identified with attributes id. It also has parameters type and serviceEndpoint.
    -   type:  indicates the type of the service can be, for example, Messaging service, CrendentialRepositoryService, etc.
    -   serviceEndpoint: the content of the service end point can be third-party account, personal website address, email address, service address or the address of the verifiable credentials.
-   proof: it is used to proof the content integrity and source reliability of the DDO document. It contains property like type, creator and signatureValue.
    -   type:  indicate the type of the proof, e.g.,LinkedDataSignature2015
    -   creator: indicate the creator of the proof, which is a public key
    -   signatureValue:  base64 encoding scheme is performed after signing with private key
-   isEnable: indicate whether the RAY is enabled
-   Extra: this field is used by user to add extra dereference content

Following is one DDO example:

```
{
  "@context": " https://www.w3.org/2019/did/v1",
  "id": "did:ray:3acdafe161ef702033bdf895",
  "name":"shiweijun",
  "publicKey": [{
    "id": "did:ray:3acdafe161ef702033bdf895#keys-1",
    "type": "RsaVerificationKey2018",
    "controller": "did:ray:3acdafe161ef702033bdf895",
    "authorizations": ["all"]，
    "ray": "did:ray: 3acdafe161ef702033bdf895
  }, {
    "id": "did:ray:3acdafe161ef702033bdf895#keys-3",
    "type": "Ieee2410VerificationKey2018",
    "controller": "did:ray:3acdafe161ef702033bdf895",
    "ray": "did:ray: 3acdafe161ef702033bdf895"
  }],
  "authentication": [{
    "type": "ED25519SigningAuthentication",
    "publicKey": "did:ray:3acdafe161ef702033bdf895#keys-1",
    "proofId":"c1cb770ac94000d946e583d13ea310"
            }],
  "service": [{
			"id": "did:ray: 3acdafe161ef702033bdf895#home_page ",
			"type": "DIDResolve",
			"serviceEndpoint": "http://www.caict.ac.cn"
		}
	],
	"proof": {
		"type": "RsaSignature2018", 
		"created": "2017-10-24T05:33:31Z",
		"creator": "did:ray: 3acdafe161ef702033bdf895#keys-1",
		"signatureValue": "eyiOiJJ0eXAK...EjXkgFWFO"
	},
   "Extra":"abc123",
   "isEnable":true,
   "created":1561945638,
   "updated":1561945638
}
```

### 6. RAY method specification

#### 6.1 Create

RAY identifier creation scheme is identical to the creation scheme of RAY wallet. The details are as follows:

- First of all, the user inputs the username and password for the wallet

- Then ,the RAY identifier, and corresponding private key and public key are generated by selected cryptographic algorithm. To manage private key, two schemes are provided.

    - One is that users manage the private key on the agent. After the private key is generated, the private key or the keystore is saved in the local agent

    - The other is that users manage the private key with mnemonic words as follows.

        - Mnemonic words are generated according to the private key

        - perform mnemonic words detection

        - Finish registration
        
#### 6.2 Update

BIdContract is a smart contract of the RAY protocol on the RAY blockchain platform. With BIdContract, users can perform actions like managing public key lists, modifying profiles, and setting up nickname, etc.

#####  6.2.1 Set RAY nickname

Users can call the SetBidName method to set and update the RAY nickname. Only the public key with authorization value equaling to  'all' can perform the modification action.

```
bool SetBidName(string name);
```

​         name: ray nickname, if null, it is set to RAY identifier by default.

#####  6.2.2 Add authorization

RAY supports authorization control, which means an user can authorize other RAYs to control current RAY, such as update the DDO document, etc. An user can call the addBid method to authorize privileges to other RAYs. Only the public key with authorization value equaling to  'all' can perform this action.

```
 bool addPublicKey(string type,string ray,string authorizations)
```

Parameters explanation:

​        type: indicate the encryption scheme, e.g., RSA or ECC used to generate ray, which is also one of the input parameters

​        ray: input RAY value

​        authorizations: privileges authorized to this RAY

#####  6.2.3 Cancel authorization

Users can cancel the privileges authorized to other RAYs by calling the deleteBid method. Only the public key with authorizations value 'all' can perform the delete action. Moreover, the account with authorization value equaling to  'all'  cannot cancel the authorization by itself.

```
 bool deletePublicKey(string publickey)
```

Parameters:

​         publickey: input value of parameter publickey

##### 6.2.4 Add verifiable credentials

RAY supports identity authentication from multiple sources. After the authentication,  verifiable identity credential is obtained. Users can add the abstract of the credential into the DDO document for further presentation and management. Credentials can be added by calling addAuthentication method. Only the public key with authorization value equaling to 'all' can perform this action.

##### 6.2.5 Delete verifiable credentials

The verifiable credentials can be delete by calling method deleteAuthentication. Only the public key with authorization value equaling to 'all' can perform this action.

```
 bool deleteAuthentication (string proofId)
```

Parameters:

​        proofId: ID number of the verification credential which is saved on the chain

##### 6.2.6 Add service endpoint

The service endpoint information can be added by calling the method addService.

```
 bool addService (string id,string type,string serviceEndpoint)
```

Parameters:

​        id: the unique ID for service

​        type: indicate the type of the service, e.g., MessagingService，CredentialRepositoryService

​        serviceEndpoint: the content of the service end point can be third-party account, personal website address, email address, service address or the address of the verifiable credentials.

##### 6.2.7 Delete service endpoint

The service endpoint information can be added by calling the method addService.

```
 bool deleteService (string id)
```

Parameters:

​        id: the unique ID identifying the service endpoint

#### 6.3 Read

RAY document, as well as detailed information that is public to all, can be obtained by querying the the RAY or the nickname of the RAY.   JSON is fed back to respond the querying.

For example, we can obtain the RAY document of ray: did:ray:6cc796b8d6e2fbebc9b3cf9e by visiting the link:http://did.pengray.cn/did:ray:6cc796b8d6e2fbebc9b3cf9e. The specific feedback information is listed as follows:

```
{
    "@context": "https://w3id.org/future-method/v1",
    "Id": "did:ray:6cc796b8d6e2fbebc9b3cf9e",
    "name": "did:ray:6cc796b8d6e2fbebc9b3cf9e",
    "type": "1",
    "publicKeys": [
        {
            "id": "did:ray:6cc796b8d6e2fbebc9b3cf9e",
            "keyId": "did:ray:6cc796b8d6e2fbebc9b3cf9e#key-1",
            "type": "secp256k1",
            "controller": "did:ray:6cc796b8d6e2fbebc9b3cf9e",
            "authority": "all",
            "publicKey": "04862d66d1255c7ac9c6d86920081069a4d7c295c838140217644ac6f4fcddd0d2edef63951148affb107223fbd1331363e275125bc0cfeb34b1daad26328f8b20"
        },
        {
            "id": "did:ray:6cc796b8d6e2fbebc9b3cf9e",
            "keyId": "did:ray:6cc796b8d6e2fbebc9b3cf9e#key-2",
            "type": "secp256k1",
            "controller": "did:ray:6cc796b8d6e2fbebc9b3cf9e",
            "authority": "base",
            "publicKey": "237755f59dfa66f8b1a55b8212824bd1bad707fd65e85c41975721deab7cf081389eced53a02d164dff39813857a132053458d5b6914b7c793659f9629756d46fd"
        }
    ],
    "authentications": [
        {
            "proofId": "047755f59dfa66f8b1a55b8212824bd1bad707fd65e85c41975721deab7cf081389eced53a02d164dff39813857a132053458d5b6914b7c793659f9629756d46fc",
            "type": "0000000000000000000000006469643a6269643a",
            "publicKey": "04862d66d1255c7ac9c6d86920081069a4d7c295c838140217644ac6f4fcddd0d2edef63951148affb107223fbd1331363e275125bc0cfeb34b1daad26328f8b20"
        }
    ],
     "service": [{
			"id": "did:ray: 6cc796b8d6e2fbebc9b3cf9e #home_page ",
			"type": "DIDResolve",
			"serviceEndpoint": "http://www.caict.ac.cn"
		}
	],
	"proof": {
		"type": "RsaSignature2018", 
		"created": "2020-5-24T05:33:31Z",
		"creator": "did:ray: 6cc796b8d6e2fbebc9b3cf9e #keys-1",
		"signatureValue": " eyiOiJJ0eXAK...EjXkgFWFO"
	},    
"isEnable": "1",
“extra”:””,
    "createTime": "2020-05-28 11:05:11.30368586 +0000 UTC m=+13192765.228065190",
    "updateTime": "2020-05-28 11:05:11.303686021 +0000 UTC m=+13192765.228065329"
}
```

#### 6.4  Deactivate

##### 6.4.1 Activate

The RAY can be activated by calling the method enable. Only the public key with authorization value equaling to 'all' can perform this action.

```
bool enable()
```

##### 6.4.2 Deactivate

The RAY can be deactivated by calling the method disable. Only the public key with authorization value equaling to 'all' can perform this action.

```
bool disable()
```



### 7. Identity verification

In this section, the complete identity verification procedure is elaborated.

As indicated in the diagram above, the complete procedure is:

- The user submits basic identity information and queries identity credential from the trust anchor
- The trust anchor verifies the information. If passed, the trust anchor generates identity credentials and save the proof information indicating the availability of the credential on chain.
- The trust anchor sends credentials to the applying user. After that, the user saves credentials in the repository.
- Assuming the user is going to visit the third-party application, or query other service from off-line institution, the identity credentials are required by the application or the institution (verifier).
- User looks up identity credentials from credentials repository.
- The user sends verifiable information or present the verifiable credentials to the verifier.
- The verifier obtain proof information of the credential from the blockchain.
- The verifier verify the identity with blockchain, and the blockchain feeds back the verification result to the verifier. The procedure is compete.

### 8. Privacy and Security considerations

#### 8.1 Privacy Considerations

In order to protect users‘ privacy, RAY saves all private data in the users' local client. Moreover, RAY adopts zero-knowledge proof algorithm and C-L signature algorithm on the basis of the original public and private keys to further enhance data privacy.

**Prevent privacy data theft attacks**

In RAY system, all users' private data is stored in local area. Only the hash value or strings generated by crypt algorithms of the data are public on-chain, the attachers cannot derive the private data with the hash value or strings.

#### 8.2 Security considerations

The following two threats are considered in the RAY method design:

**Prevent DDOS attacks**

RAY system is built based on blockchain technology, which naturally prevents DDoS attack.

**Conensus security**

RAY adopts two-tier consensus algorithms including DPOS and PBFT to keep stability of blockchain nodes .

#### 8.3 Cryptographic algorithms

RAY system adopts several  cryptographic algorithms to keep data safe and private.

**Signature**

Signature is a process of encryption of the hash of message with private key. When a node sends message to another one, the node will sign the message with its private key, and then send the signature to the other node together with the message.

The signature scheme procedure is depicted in the diagram below.

**Verify the signature**


From the receiver's point of view,  after the signature and message is received, the receiver will derive public key of the sender with received signature and message. Then the receiver will calculate one r value through public key, signature and message. During the verification, the receiver will compare the calculated r with the r sent by sender. If they are identical, the verification is done.
